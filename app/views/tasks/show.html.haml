%article.task{ data: { id: @task.id }}
  %nav
    = render 'layouts/breadcrumb', task: @task

  %h1.name
    = @task.name

  = render 'summary', task: @task

  - if @task.children.any?
    .child-tasks
      %h2 Children

      %table.table
        %tr
          %th Name
          %th Reference
          %th Goal
          %th Weight
          %th Adjusted Weight
          %th Status
          %th Last done on
          %th Done count
          %th Actions

        :ruby
          children =
            @task.children
              .order('last_done_on, done_count, adjusted_weight desc, name')

        - children.each do |child_task|
          %tr.child-task{ data: { id: child_task.id }}
            %td= link_to(child_task.name, task_path(child_task), class: 'task-link')

            %td
              - reference = child_task.reference
              - if reference
                = link_to(reference.name, task_path(reference))

            %td= child_task.goal
            %td= child_task.weight
            %td= child_task.adjusted_weight.round(2)
            %td= child_task.status.name
            %td= child_task.last_done_on
            %td= child_task.done_count
            %td
              = render 'show_actions', task: child_task
